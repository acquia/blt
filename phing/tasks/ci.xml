<project name="ci" default="ci:setup">

  <target name="ci:build:test"
          description="Builds, tests, and deploys an artifact; uses ci drush alias."
          depends="ci:setup, tests:all" hidden="true">
  </target>

  <target name="ci:build:validate:test"
          description="Builds, validates, tests, and deploys an artifact; uses ci drush alias."
          depends="validate:all, ci:setup, tests:all" hidden="true">
  </target>

  <target name="ci:setup" description="Install dependencies, builds docroot, installs Drupal; uses ci drush alias." hidden="true">
    <phingcall target="setup">
      <property name="drush.alias" value="${drush.aliases.ci}"/>
      <property name="create_alias" value="n"/>
    </phingcall>
  </target>

  <target name="ci:pipelines:init" description="Initializes default Acquia Pipelines configuration for this project.">
    <copy file="${blt.root}/scripts/pipelines/acquia-pipelines.yml" tofile="${repo.root}/acquia-pipelines.yml"/>
  </target>

  <target name="ci:travis:init" description="Initializes default Travis CI configuration for this project.">
    <copy file="${blt.root}/scripts/travis/.travis.yml" tofile="${repo.root}/.travis.yml"/>
  </target>

  <target name="ci:tugboat:init" description="Initializes default tugboat configuration for this project.">
    <copy file="${blt.root}/scripts/tugboat/Makefile" tofile="${repo.root}/Makefile"/>
    <copy file="${blt.root}/scripts/tugboat/tugboat.drushrc.aliases.php" todir="${repo.root}/drush/site-aliases">
      <filterchain>
        <expandproperties />
      </filterchain>
    </copy>
  </target>

  <target name="ci:update" description="Update current database to reflect the state of the Drupal file system; uses ci drush alias." hidden="true">
    <phingcall target="setup:update">
      <property name="drush.alias" value="${drush.aliases.ci}"/>
    </phingcall>
  </target>

  <target name="ci:toggle-modules" description="Enables modules.ci.enable projects and uninstalls modules.ci.uninstall projects.">
    <phingcall target="setup:toggle-modules">
      <param name="enable" value="${modules.ci.enable}"/>
      <param name="uninstall" value="${modules.ci.uninstall}"/>
    </phingcall>
  </target>
</project>
